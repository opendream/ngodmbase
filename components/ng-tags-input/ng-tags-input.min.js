(function(){'use strict';var o={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,comma:'U+002C'};var p=9007199254740991;var q=['text','email','url'];var r=angular.module('ngTagsInput',[]);r.directive('tagsInput',["$timeout","$document","tagsInputConfig","tiUtil",function(k,l,m,n){function TagList(c,d){var e={},getTagText,setTagText,tagIsValid;getTagText=function(a){return n.safeToString(a[c.displayProperty])};setTagText=function(a,b){a[c.displayProperty]=b};tagIsValid=function(a){var b=getTagText(a);return b&&b.length>=c.minLength&&b.length<=c.maxLength&&c.allowedTagsPattern.test(b)&&!n.findInObjectArray(e.items,a,c.displayProperty)};e.items=[];e.addText=function(a){var b={};setTagText(b,a);return e.add(b)};e.add=function(a){var b=getTagText(a);if(c.replaceSpacesWithDashes){b=b.replace(/\s/g,'-')}setTagText(a,b);if(tagIsValid(a)){e.items.push(a);d.trigger('tag-added',{$tag:a})}else if(b){d.trigger('invalid-tag',{$tag:a})}return a};e.remove=function(a){var b=e.items.splice(a,1)[0];d.trigger('tag-removed',{$tag:b});return b};e.removeLast=function(){var a,lastTagIndex=e.items.length-1;if(c.enableEditingLastTag||e.selected){e.selected=null;a=e.remove(lastTagIndex)}else if(!e.selected){e.selected=e.items[lastTagIndex]}return a};return e}function validateType(a){return q.indexOf(a)!==-1}return{restrict:'E',require:'ngModel',scope:{tags:'=ngModel',onTagAdded:'&',onInvalidTag:'&',onTagRemoved:'&'},replace:false,transclude:true,templateUrl:'ngTagsInput/tags-input.html',controller:["$scope","$attrs","$element",function(d,e,f){d.events=n.simplePubSub();m.load('tagsInput',d,e,{type:[String,'text',validateType],placeholder:[String,'Add a tag'],tabindex:[Number,null],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,true],minLength:[Number,3],maxLength:[Number,p],addOnEnter:[Boolean,true],addOnSpace:[Boolean,false],addOnComma:[Boolean,true],addOnBlur:[Boolean,true],addOnPaste:[Boolean,false],pasteSplitPattern:[RegExp,/,/],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,false],minTags:[Number,0],maxTags:[Number,p],displayProperty:[String,'text'],allowLeftoverText:[Boolean,false],addFromAutocompleteOnly:[Boolean,false],spellcheck:[Boolean,true]});d.tagList=new TagList(d.options,d.events);this.registerAutocomplete=function(){var c=f.find('input');return{addTag:function(a){return d.tagList.add(a)},focusInput:function(){c[0].focus()},getTags:function(){return d.tags},getCurrentTagText:function(){return d.newTag.text},getOptions:function(){return d.options},on:function(a,b){d.events.on(a,b);return this}}}}],link:function(f,g,h,i){var j=[o.enter,o.space,o.backspace],tagList=f.tagList,events=f.events,options=f.options,input=g.find('input'),validationOptions=['minTags','maxTags','allowLeftoverText'],setElementValidity;setElementValidity=function(){i.$setValidity('maxTags',f.tags.length<=options.maxTags);i.$setValidity('minTags',f.tags.length>=options.minTags);i.$setValidity('leftoverText',options.allowLeftoverText?true:!f.newTag.text)};f.newTag={text:'',invalid:null,setText:function(a){this.text=a;events.trigger('input-change',a)}};f.getDisplayText=function(a){return n.safeToString(a[options.displayProperty])};f.track=function(a){return a[options.displayProperty]};f.$watch('tags',function(a){f.tags=n.makeObjectArray(a,options.displayProperty);tagList.items=f.tags});f.$watch('tags.length',function(){setElementValidity()});f.eventHandlers={input:{change:function(a){events.trigger('input-change',a)},keydown:function(a){events.trigger('input-keydown',a)},focus:function(){if(f.hasFocus){return}f.hasFocus=true;events.trigger('input-focus')},blur:function(){k(function(){var a=l.prop('activeElement'),lostFocusToBrowserWindow=a===input[0],lostFocusToChildElement=g[0].contains(a);if(lostFocusToBrowserWindow||!lostFocusToChildElement){f.hasFocus=false;events.trigger('input-blur')}})},paste:function(a){events.trigger('input-paste',a)}},host:{click:function(){input[0].focus()}}};events.on('tag-added',f.onTagAdded).on('invalid-tag',f.onInvalidTag).on('tag-removed',f.onTagRemoved).on('tag-added',function(){f.newTag.setText('')}).on('tag-added tag-removed',function(){i.$setViewValue(f.tags)}).on('invalid-tag',function(){f.newTag.invalid=true}).on('option-change',function(e){if(validationOptions.indexOf(e.name)!==-1){setElementValidity()}}).on('input-change',function(){tagList.selected=null;f.newTag.invalid=null}).on('input-focus',function(){g.triggerHandler('focus');i.$setValidity('leftoverText',true)}).on('input-blur',function(){if(options.addOnBlur&&!options.addFromAutocompleteOnly){tagList.addText(f.newTag.text)}g.triggerHandler('blur');setElementValidity()}).on('input-keydown',function(a){var b=a.keyCode,isModifier=a.shiftKey||a.altKey||a.ctrlKey||a.metaKey,addKeys={},shouldAdd,shouldRemove;if((isModifier||j.indexOf(b)===-1)&&(options.addOnComma&&a.originalEvent.keyIdentifier!=o.comma)){return}addKeys[o.enter]=options.addOnEnter;addKeys[o.space]=options.addOnSpace;shouldAdd=(!options.addFromAutocompleteOnly&&addKeys[b])||(options.addOnComma&&a.originalEvent.keyIdentifier==o.comma);shouldRemove=!shouldAdd&&b===o.backspace&&f.newTag.text.length===0;if(shouldAdd){tagList.addText(f.newTag.text);a.preventDefault()}else if(shouldRemove){var c=tagList.removeLast();if(c&&options.enableEditingLastTag){f.newTag.setText(c[options.displayProperty])}a.preventDefault()}}).on('input-paste',function(b){if(options.addOnPaste){var c=b.clipboardData.getData('text/plain');var d=c.split(options.pasteSplitPattern);if(d.length>1){d.forEach(function(a){tagList.addText(a)});b.preventDefault()}}})}}}]);r.directive('autoComplete',["$document","$timeout","$sce","$q","tagsInputConfig","tiUtil",function(h,i,j,k,l,m){function SuggestionList(e,f){var g={},getDifference,lastPromise;getDifference=function(b,c){return b.filter(function(a){return!m.findInObjectArray(c,a,f.tagsInput.displayProperty)})};g.reset=function(){lastPromise=null;g.items=[];g.visible=false;g.index=-1;g.selected=null;g.query=null};g.show=function(){if(f.selectFirstMatch){g.select(0)}else{g.selected=null}g.visible=true};g.load=m.debounce(function(b,c){g.query=b;var d=k.when(e({$query:b}));lastPromise=d;d.then(function(a){if(d!==lastPromise){return}a=m.makeObjectArray(a.data||a,f.tagsInput.displayProperty);a=getDifference(a,c);g.items=a.slice(0,f.maxResultsToShow);if(g.items.length>0){g.show()}else{g.reset()}})},f.debounceDelay);g.selectNext=function(){g.select(++g.index)};g.selectPrior=function(){g.select(--g.index)};g.select=function(a){if(a<0){a=g.items.length-1}else if(a>=g.items.length){a=0}g.index=a;g.selected=g.items[a]};g.reset();return g}return{restrict:'E',require:'^tagsInput',scope:{source:'&'},templateUrl:'ngTagsInput/auto-complete.html',link:function(c,d,e,f){var g=[o.enter,o.tab,o.escape,o.up,o.down],suggestionList,r,options,getItem,getDisplayText,shouldLoadSuggestions;l.load('autoComplete',c,e,{debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,true],maxResultsToShow:[Number,10],loadOnDownArrow:[Boolean,false],loadOnEmpty:[Boolean,false],loadOnFocus:[Boolean,false],selectFirstMatch:[Boolean,true]});options=c.options;r=f.registerAutocomplete();options.tagsInput=r.getOptions();suggestionList=new SuggestionList(c.source,options);getItem=function(a){return a[options.tagsInput.displayProperty]};getDisplayText=function(a){return m.safeToString(getItem(a))};shouldLoadSuggestions=function(a){return a&&a.length>=options.minLength||!a&&options.loadOnEmpty};c.suggestionList=suggestionList;c.addSuggestionByIndex=function(a){suggestionList.select(a);c.addSuggestion()};c.addSuggestion=function(){var a=false;if(suggestionList.selected){r.addTag(suggestionList.selected);suggestionList.reset();r.focusInput();a=true}return a};c.highlight=function(a){var b=getDisplayText(a);b=m.encodeHTML(b);if(options.highlightMatchedText){b=m.safeHighlight(b,m.encodeHTML(suggestionList.query))}return j.trustAsHtml(b)};c.track=function(a){return getItem(a)};r.on('tag-added invalid-tag input-blur',function(){suggestionList.reset()}).on('input-change',function(a){if(shouldLoadSuggestions(a)){suggestionList.load(a,r.getTags())}else{suggestionList.reset()}}).on('input-focus',function(){var a=r.getCurrentTagText();if(options.loadOnFocus&&shouldLoadSuggestions(a)){suggestionList.load(a,r.getTags())}}).on('input-keydown',function(a){var b=a.keyCode,handled=false;if(g.indexOf(b)===-1){return}if(suggestionList.visible){if(b===o.down){suggestionList.selectNext();handled=true}else if(b===o.up){suggestionList.selectPrior();handled=true}else if(b===o.escape){suggestionList.reset();handled=true}else if(b===o.enter||b===o.tab){handled=c.addSuggestion()}}else{if(b===o.down&&c.options.loadOnDownArrow){suggestionList.load(r.getCurrentTagText(),r.getTags());handled=true}}if(handled){a.preventDefault();a.stopImmediatePropagation();return false}})}}}]);r.directive('tiTranscludeAppend',function(){return function(b,c,d,e,f){f(function(a){c.append(a)})}});r.directive('tiAutosize',["tagsInputConfig",function(h){return{restrict:'A',require:'ngModel',link:function(c,d,e,f){var g=h.getTextAutosizeThreshold(),span,resize;span=angular.element('<span class="input"></span>');span.css('display','none').css('visibility','hidden').css('width','auto').css('white-space','pre');d.parent().append(span);resize=function(a){var b=a,width;if(angular.isString(b)&&b.length===0){b=e.placeholder}if(b){span.text(b);span.css('display','');width=span.prop('offsetWidth');span.css('display','none')}d.css('width',width?width+g+'px':'');return a};f.$parsers.unshift(resize);f.$formatters.unshift(resize);e.$observe('placeholder',function(a){if(!f.$modelValue){resize(a)}})}}}]);r.directive('tiBindAttrs',function(){return function(d,e,f){d.$watch(f.tiBindAttrs,function(c){angular.forEach(c,function(a,b){f.$set(b,a)})},true)}});r.provider('tagsInputConfig',function(){var l={},interpolationStatus={},autosizeThreshold=3;this.setDefaults=function(a,b){l[a]=b;return this};this.setActiveInterpolation=function(a,b){interpolationStatus[a]=b;return this};this.setTextAutosizeThreshold=function(a){autosizeThreshold=a;return this};this.$get=["$interpolate",function(j){var k={};k[String]=function(a){return a};k[Number]=function(a){return parseInt(a,10)};k[Boolean]=function(a){return a.toLowerCase()==='true'};k[RegExp]=function(a){return new RegExp(a)};return{load:function(e,f,g,h){var i=function(){return true};f.options={};angular.forEach(h,function(b,c){var d,localDefault,validator,converter,getDefault,updateValue;d=b[0];localDefault=b[1];validator=b[2]||i;converter=k[d];getDefault=function(){var a=l[e]&&l[e][c];return angular.isDefined(a)?a:localDefault};updateValue=function(a){f.options[c]=a&&validator(a)?converter(a):getDefault()};if(interpolationStatus[e]&&interpolationStatus[e][c]){g.$observe(c,function(a){updateValue(a);f.events.trigger('option-change',{name:c,newValue:a})})}else{updateValue(g[c]&&j(g[c])(f.$parent))}})},getTextAutosizeThreshold:function(){return autosizeThreshold}}}]});r.factory('tiUtil',["$timeout",function(g){var h={};h.debounce=function(b,c){var d;return function(){var a=arguments;g.cancel(d);d=g(function(){b.apply(null,a)},c)}};h.makeObjectArray=function(c,d){c=c||[];if(c.length>0&&!angular.isObject(c[0])){c.forEach(function(a,b){c[b]={};c[b][d]=a})}return c};h.findInObjectArray=function(a,b,c){var d=null;for(var i=0;i<a.length;i++){if(h.safeToString(a[i][c]).toLowerCase()===h.safeToString(b[c]).toLowerCase()){d=a[i];break}}return d};h.safeHighlight=function(b,c){if(!c){return b}function escapeRegexChars(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,'\\$1')}var d=new RegExp('&[^;]+;|'+escapeRegexChars(c),'gi');return b.replace(d,function(a){return a===c?'<em>'+c+'</em>':a})};h.safeToString=function(a){return angular.isUndefined(a)||a==null?'':a.toString().trim()};h.encodeHTML=function(a){return a.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')};h.simplePubSub=function(){var f={};return{on:function(b,c){b.split(' ').forEach(function(a){if(!f[a]){f[a]=[]}f[a].push(c)});return this},trigger:function(c,d){var e=f[c]||[];e.every(function(a){var b=a.call(null,d);return angular.isUndefined(b)||b});return this}}};return h}]);r.run(["$templateCache",function(a){a.put('ngTagsInput/tags-input.html',"<div class=\"host\" tabindex=\"-1\" ng-click=\"eventHandlers.host.click()\" ti-transclude-append=\"\"><div class=\"tags\" ng-class=\"{focused: hasFocus}\"><ul class=\"tag-list\"><li class=\"tag-item\" ng-repeat=\"tag in tagList.items track by track(tag)\" ng-class=\"{ selected: tag == tagList.selected }\"><span ng-bind=\"getDisplayText(tag)\"></span> <a class=\"remove-button\" ng-click=\"tagList.remove($index)\" ng-bind=\"options.removeTagSymbol\"></a></li></ul><input class=\"input\" ng-model=\"newTag.text\" ng-change=\"eventHandlers.input.change(newTag.text)\" ng-keydown=\"eventHandlers.input.keydown($event)\" ng-focus=\"eventHandlers.input.focus($event)\" ng-blur=\"eventHandlers.input.blur($event)\" ng-paste=\"eventHandlers.input.paste($event)\" ng-trim=\"false\" ng-class=\"{'invalid-tag': newTag.invalid}\" ti-bind-attrs=\"{type: options.type, placeholder: options.placeholder, tabindex: options.tabindex, spellcheck: options.spellcheck}\" ti-autosize=\"\"></div></div>");a.put('ngTagsInput/auto-complete.html',"<div class=\"autocomplete\" ng-show=\"suggestionList.visible\"><ul class=\"suggestion-list\"><li class=\"suggestion-item\" ng-repeat=\"item in suggestionList.items track by track(item)\" ng-class=\"{selected: item == suggestionList.selected}\" ng-click=\"addSuggestionByIndex($index)\" ng-mouseenter=\"suggestionList.select($index)\" ng-bind-html=\"highlight(item)\"></li></ul></div>")}])}());